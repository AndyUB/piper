2026-02-03 00:29:22,243	INFO worker.py:2007 -- Started a local Ray instance.
/m-coriander/coriander/wxdeng/conda-envs/piper_ref/lib/python3.10/site-packages/ray/_private/worker.py:2046: FutureWarning: Tip: In future versions of Ray, Ray will no longer override accelerator visible devices env var if num_gpus=0 or num_gpus=None (default). To enable this behavior and turn off this error message, set RAY_ACCEL_ENV_VAR_OVERRIDE_ON_ZERO=0
  warnings.warn(
session_dir = /home/wxdeng/ray_tmp/ray/session_2026-02-03_00-29-16_480110_1006833
logs_dir    = /home/wxdeng/ray_tmp/ray/session_2026-02-03_00-29-16_480110_1006833/logs
[36m(PiperProgramCoordinator pid=1007647)[0m 2026-02-03 00:29:31,528 - piper_coordinator - INFO - Running program with 1 DP ranks and 2 PP ranks
[36m(run_dp_rank pid=1007640)[0m Namespace(model='LLAMA_3B', schedule='interleaved-1f1b', num_stages=4, dp_degree=1, pp_degree=2, batch_size=16, num_mbs=4, seq_len=256, warmup=1, iters=1, tracing=False, verify_weights=False)
[36m(run_dp_rank pid=1007640)[0m 2026-02-03 00:30:00,941 - piper_compile - INFO - DP rank 0 compiling 4 stages...
[33m(raylet)[0m WARNING: Device-side CUDA Event completion trace is currently enabled.
[33m(raylet)[0m          This may increase runtime overhead and the likelihood of false
[33m(raylet)[0m          dependencies across CUDA Streams. If you wish to avoid this, please
[33m(raylet)[0m          disable the feature with --cuda-event-trace=false.
[36m(PiperActor pid=1024950)[0m 2026-02-03 00:30:28,487 - piper_actor - INFO - Initializing Ray actor 0 global rank 0 with PID: 1024950
[33m(raylet)[0m WARNING: Device-side CUDA Event completion trace is currently enabled.
[33m(raylet)[0m          This may increase runtime overhead and the likelihood of false
[33m(raylet)[0m          dependencies across CUDA Streams. If you wish to avoid this, please
[33m(raylet)[0m          disable the feature with --cuda-event-trace=false.
[36m(PiperActor pid=1025870)[0m 2026-02-03 00:30:49,027 - piper_actor - INFO - Initializing Ray actor 1 global rank 1 with PID: 1025870
[36m(run_dp_rank pid=1007640)[0m 2026-02-03 00:31:17,294 - piper_compile - INFO - DP rank 0 joining process groups
[36m(run_dp_rank pid=1007640)[0m 2026-02-03 00:31:17,355 - piper_compile - INFO - DP rank 0 completed setup for 2 actors
[36m(run_dp_rank pid=1007640)[0m SCHEDULE:
[36m(run_dp_rank pid=1007640)[0m 0:0:f	0:1:f	2:0:f	2:1:f	0:2:f	0:3:f	2:0:b	 -- 	2:1:b	2:2:f	0:0:b	2:3:f	0:1:b	 -- 	2:2:b	2:3:b	0:2:b	0:3:b	0:0:u	
[36m(run_dp_rank pid=1007640)[0m  -- 	1:0:f	1:1:f	3:0:f	3:0:b	3:1:f	3:1:b	1:2:f	1:0:b	1:3:f	1:1:b	3:2:f	3:2:b	3:3:f	3:3:b	1:2:b	1:3:b	1:0:u	 -- 	
[36m(run_dp_rank pid=1007640)[0m 2026-02-03 00:31:17,972 - piper_compile - INFO - DP rank 0 Started NCCL group with 2 actors
[36m(run_dp_rank pid=1007640)[0m Running 1 warmup iterations...
[36m(PiperActor pid=1024950)[0m 2026-02-03 00:31:18,006 - piper_actor - INFO - Actor 0: Tracing disabled
[33m(raylet)[0m WARNING: Device-side CUDA Event completion trace is currently enabled.
[33m(raylet)[0m          This may increase runtime overhead and the likelihood of false
[33m(raylet)[0m          dependencies across CUDA Streams. If you wish to avoid this, please
[33m(raylet)[0m          disable the feature with --cuda-event-trace=false.
[36m(run_dp_rank pid=1007640)[0m Running 1 timed iterations...
[36m(run_dp_rank pid=1007640)[0m Iteration time: 6704 ms
[36m(run_dp_rank pid=1007640)[0m interleaved-1f1b throughput: 2444 tokens/sec
[36m(run_dp_rank pid=1007640)[0m (Force sync) trace data from Actor 0:
[36m(run_dp_rank pid=1007640)[0m {
[36m(run_dp_rank pid=1007640)[0m     "update": {
[36m(run_dp_rank pid=1007640)[0m         "total": [],
[36m(run_dp_rank pid=1007640)[0m         "peak_memory_delta": [],
[36m(run_dp_rank pid=1007640)[0m         "peak_memory": []
[36m(run_dp_rank pid=1007640)[0m     },
[36m(run_dp_rank pid=1007640)[0m     "0": {
[36m(run_dp_rank pid=1007640)[0m         "forward": {
[36m(run_dp_rank pid=1007640)[0m             "forward": [
[36m(run_dp_rank pid=1007640)[0m                 122.68029022216797,
[36m(run_dp_rank pid=1007640)[0m                 123.24681854248047,
[36m(run_dp_rank pid=1007640)[0m                 180.92665100097656,
[36m(run_dp_rank pid=1007640)[0m                 123.7014389038086
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "forward_ref": [
[36m(run_dp_rank pid=1007640)[0m                 122.91908101178706,
[36m(run_dp_rank pid=1007640)[0m                 123.50091501139104,
[36m(run_dp_rank pid=1007640)[0m                 181.10074801370502,
[36m(run_dp_rank pid=1007640)[0m                 124.21536701731384
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "total": [
[36m(run_dp_rank pid=1007640)[0m                 124.40290581434965,
[36m(run_dp_rank pid=1007640)[0m                 125.04813517443836,
[36m(run_dp_rank pid=1007640)[0m                 181.38016411103308,
[36m(run_dp_rank pid=1007640)[0m                 125.49920612946153
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "peak_memory_delta": [],
[36m(run_dp_rank pid=1007640)[0m             "peak_memory": []
[36m(run_dp_rank pid=1007640)[0m         },
[36m(run_dp_rank pid=1007640)[0m         "backward": {
[36m(run_dp_rank pid=1007640)[0m             "backward": [
[36m(run_dp_rank pid=1007640)[0m                 243.27587890625,
[36m(run_dp_rank pid=1007640)[0m                 246.46141052246094,
[36m(run_dp_rank pid=1007640)[0m                 246.41433715820312,
[36m(run_dp_rank pid=1007640)[0m                 248.04563903808594
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "backward_ref": [
[36m(run_dp_rank pid=1007640)[0m                 487.17634403146803,
[36m(run_dp_rank pid=1007640)[0m                 501.4710209798068,
[36m(run_dp_rank pid=1007640)[0m                 493.88596694916487,
[36m(run_dp_rank pid=1007640)[0m                 248.3364138752222
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "total": [
[36m(run_dp_rank pid=1007640)[0m                 487.2227730229497,
[36m(run_dp_rank pid=1007640)[0m                 501.50761497206986,
[36m(run_dp_rank pid=1007640)[0m                 493.92572580836713,
[36m(run_dp_rank pid=1007640)[0m                 248.37317899800837
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "peak_memory_delta": [],
[36m(run_dp_rank pid=1007640)[0m             "peak_memory": []
[36m(run_dp_rank pid=1007640)[0m         }
[36m(run_dp_rank pid=1007640)[0m     },
[36m(run_dp_rank pid=1007640)[0m     "2": {
[36m(run_dp_rank pid=1007640)[0m         "forward": {
[36m(run_dp_rank pid=1007640)[0m             "forward": [
[36m(run_dp_rank pid=1007640)[0m                 122.71676635742188,
[36m(run_dp_rank pid=1007640)[0m                 122.65094757080078,
[36m(run_dp_rank pid=1007640)[0m                 122.79071807861328,
[36m(run_dp_rank pid=1007640)[0m                 122.30352020263672
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "forward_ref": [
[36m(run_dp_rank pid=1007640)[0m                 123.00807307474315,
[36m(run_dp_rank pid=1007640)[0m                 122.90730304084718,
[36m(run_dp_rank pid=1007640)[0m                 123.05140704847872,
[36m(run_dp_rank pid=1007640)[0m                 304.68010110780597
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "total": [
[36m(run_dp_rank pid=1007640)[0m                 123.85786604136229,
[36m(run_dp_rank pid=1007640)[0m                 123.58436896465719,
[36m(run_dp_rank pid=1007640)[0m                 124.25240292213857,
[36m(run_dp_rank pid=1007640)[0m                 305.42965489439666
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "peak_memory_delta": [],
[36m(run_dp_rank pid=1007640)[0m             "peak_memory": []
[36m(run_dp_rank pid=1007640)[0m         },
[36m(run_dp_rank pid=1007640)[0m         "backward": {
[36m(run_dp_rank pid=1007640)[0m             "backward": [
[36m(run_dp_rank pid=1007640)[0m                 242.4920654296875,
[36m(run_dp_rank pid=1007640)[0m                 244.64364624023438,
[36m(run_dp_rank pid=1007640)[0m                 244.7139129638672,
[36m(run_dp_rank pid=1007640)[0m                 244.55946350097656
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "backward_ref": [
[36m(run_dp_rank pid=1007640)[0m                 1211.411751108244,
[36m(run_dp_rank pid=1007640)[0m                 614.9909810628742,
[36m(run_dp_rank pid=1007640)[0m                 873.4147490467876,
[36m(run_dp_rank pid=1007640)[0m                 493.4472041204572
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "total": [
[36m(run_dp_rank pid=1007640)[0m                 1211.4632879383862,
[36m(run_dp_rank pid=1007640)[0m                 615.0576109066606,
[36m(run_dp_rank pid=1007640)[0m                 873.4527549240738,
[36m(run_dp_rank pid=1007640)[0m                 493.4851110447198
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "peak_memory_delta": [],
[36m(run_dp_rank pid=1007640)[0m             "peak_memory": []
[36m(run_dp_rank pid=1007640)[0m         }
[36m(run_dp_rank pid=1007640)[0m     }
[36m(run_dp_rank pid=1007640)[0m }
[36m(run_dp_rank pid=1007640)[0m ========================================
[36m(run_dp_rank pid=1007640)[0m 
[36m(run_dp_rank pid=1007640)[0m Timing and Memory statistics for Actor 0:
[36m(run_dp_rank pid=1007640)[0m   Update:
[36m(run_dp_rank pid=1007640)[0m     total: nan ms
[36m(run_dp_rank pid=1007640)[0m     peak_memory_delta: nan GB
[36m(run_dp_rank pid=1007640)[0m     peak_memory: nan GB
[36m(run_dp_rank pid=1007640)[0m   Stage 0:
[36m(run_dp_rank pid=1007640)[0m     Forward:
[36m(run_dp_rank pid=1007640)[0m       forward: 137.639 ms
[36m(run_dp_rank pid=1007640)[0m       forward_ref: 137.934 ms
[36m(run_dp_rank pid=1007640)[0m       total: 139.083 ms
[36m(run_dp_rank pid=1007640)[0m       peak_memory_delta: nan GB
[36m(run_dp_rank pid=1007640)[0m       peak_memory: nan GB
[36m(run_dp_rank pid=1007640)[0m     Backward:
[36m(run_dp_rank pid=1007640)[0m       backward: 246.049 ms
[36m(run_dp_rank pid=1007640)[0m       backward_ref: 432.717 ms
[36m(run_dp_rank pid=1007640)[0m       total: 432.757 ms
[36m(run_dp_rank pid=1007640)[0m       peak_memory_delta: nan GB
[36m(run_dp_rank pid=1007640)[0m       peak_memory: nan GB
[36m(run_dp_rank pid=1007640)[0m   Stage 2:
[36m(run_dp_rank pid=1007640)[0m     Forward:
[36m(run_dp_rank pid=1007640)[0m       forward: 122.615 ms
[36m(run_dp_rank pid=1007640)[0m       forward_ref: 168.412 ms
[36m(run_dp_rank pid=1007640)[0m       total: 169.281 ms
[36m(run_dp_rank pid=1007640)[0m       peak_memory_delta: nan GB
[36m(run_dp_rank pid=1007640)[0m       peak_memory: nan GB
[36m(run_dp_rank pid=1007640)[0m     Backward:
[36m(run_dp_rank pid=1007640)[0m       backward: 244.102 ms
[36m(run_dp_rank pid=1007640)[0m       backward_ref: 798.316 ms
[36m(run_dp_rank pid=1007640)[0m       total: 798.365 ms
[36m(run_dp_rank pid=1007640)[0m       peak_memory_delta: nan GB
[36m(run_dp_rank pid=1007640)[0m       peak_memory: nan GB
[36m(run_dp_rank pid=1007640)[0m (Force sync) trace data from Actor 1:
[36m(run_dp_rank pid=1007640)[0m {
[36m(run_dp_rank pid=1007640)[0m     "update": {
[36m(run_dp_rank pid=1007640)[0m         "total": [],
[36m(run_dp_rank pid=1007640)[0m         "peak_memory_delta": [],
[36m(run_dp_rank pid=1007640)[0m         "peak_memory": []
[36m(run_dp_rank pid=1007640)[0m     },
[36m(run_dp_rank pid=1007640)[0m     "1": {
[36m(run_dp_rank pid=1007640)[0m         "forward": {
[36m(run_dp_rank pid=1007640)[0m             "forward": [
[36m(run_dp_rank pid=1007640)[0m                 122.63660430908203,
[36m(run_dp_rank pid=1007640)[0m                 122.44012451171875,
[36m(run_dp_rank pid=1007640)[0m                 122.19369506835938,
[36m(run_dp_rank pid=1007640)[0m                 121.99718475341797
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "forward_ref": [
[36m(run_dp_rank pid=1007640)[0m                 122.81710910610855,
[36m(run_dp_rank pid=1007640)[0m                 122.62856890447438,
[36m(run_dp_rank pid=1007640)[0m                 366.5890188422054,
[36m(run_dp_rank pid=1007640)[0m                 371.43653514795005
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "total": [
[36m(run_dp_rank pid=1007640)[0m                 123.37507796473801,
[36m(run_dp_rank pid=1007640)[0m                 123.02915402688086,
[36m(run_dp_rank pid=1007640)[0m                 366.9955129735172,
[36m(run_dp_rank pid=1007640)[0m                 372.1213419921696
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "peak_memory_delta": [],
[36m(run_dp_rank pid=1007640)[0m             "peak_memory": []
[36m(run_dp_rank pid=1007640)[0m         },
[36m(run_dp_rank pid=1007640)[0m         "backward": {
[36m(run_dp_rank pid=1007640)[0m             "backward": [
[36m(run_dp_rank pid=1007640)[0m                 243.6537628173828,
[36m(run_dp_rank pid=1007640)[0m                 245.92678833007812,
[36m(run_dp_rank pid=1007640)[0m                 246.55606079101562,
[36m(run_dp_rank pid=1007640)[0m                 245.92953491210938
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "backward_ref": [
[36m(run_dp_rank pid=1007640)[0m                 243.8919278793037,
[36m(run_dp_rank pid=1007640)[0m                 246.08948500826955,
[36m(run_dp_rank pid=1007640)[0m                 246.86398706398904,
[36m(run_dp_rank pid=1007640)[0m                 246.21410993859172
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "total": [
[36m(run_dp_rank pid=1007640)[0m                 243.92663105390966,
[36m(run_dp_rank pid=1007640)[0m                 246.12004007212818,
[36m(run_dp_rank pid=1007640)[0m                 246.9099040608853,
[36m(run_dp_rank pid=1007640)[0m                 246.24979309737682
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "peak_memory_delta": [],
[36m(run_dp_rank pid=1007640)[0m             "peak_memory": []
[36m(run_dp_rank pid=1007640)[0m         }
[36m(run_dp_rank pid=1007640)[0m     },
[36m(run_dp_rank pid=1007640)[0m     "3": {
[36m(run_dp_rank pid=1007640)[0m         "forward": {
[36m(run_dp_rank pid=1007640)[0m             "forward": [
[36m(run_dp_rank pid=1007640)[0m                 183.56582641601562,
[36m(run_dp_rank pid=1007640)[0m                 183.51622009277344,
[36m(run_dp_rank pid=1007640)[0m                 182.903076171875,
[36m(run_dp_rank pid=1007640)[0m                 183.0584259033203
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "forward_ref": [
[36m(run_dp_rank pid=1007640)[0m                 183.91445116139948,
[36m(run_dp_rank pid=1007640)[0m                 183.64464910700917,
[36m(run_dp_rank pid=1007640)[0m                 426.838360959664,
[36m(run_dp_rank pid=1007640)[0m                 430.6489350274205
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "total": [
[36m(run_dp_rank pid=1007640)[0m                 184.70477615483105,
[36m(run_dp_rank pid=1007640)[0m                 184.1338670346886,
[36m(run_dp_rank pid=1007640)[0m                 427.57562594488263,
[36m(run_dp_rank pid=1007640)[0m                 431.39570485800505
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "peak_memory_delta": [],
[36m(run_dp_rank pid=1007640)[0m             "peak_memory": []
[36m(run_dp_rank pid=1007640)[0m         },
[36m(run_dp_rank pid=1007640)[0m         "backward": {
[36m(run_dp_rank pid=1007640)[0m             "backward": [
[36m(run_dp_rank pid=1007640)[0m                 455.4929504394531,
[36m(run_dp_rank pid=1007640)[0m                 777.193603515625,
[36m(run_dp_rank pid=1007640)[0m                 378.0816955566406,
[36m(run_dp_rank pid=1007640)[0m                 440.0360107421875
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "backward_ref": [
[36m(run_dp_rank pid=1007640)[0m                 455.68283391185105,
[36m(run_dp_rank pid=1007640)[0m                 777.3567328695208,
[36m(run_dp_rank pid=1007640)[0m                 378.2943079713732,
[36m(run_dp_rank pid=1007640)[0m                 440.2055589016527
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "total": [
[36m(run_dp_rank pid=1007640)[0m                 455.7168339379132,
[36m(run_dp_rank pid=1007640)[0m                 777.3935589939356,
[36m(run_dp_rank pid=1007640)[0m                 378.33468709141016,
[36m(run_dp_rank pid=1007640)[0m                 440.2471308130771
[36m(run_dp_rank pid=1007640)[0m             ],
[36m(run_dp_rank pid=1007640)[0m             "peak_memory_delta": [],
[36m(run_dp_rank pid=1007640)[0m             "peak_memory": []
[36m(run_dp_rank pid=1007640)[0m         }
[36m(run_dp_rank pid=1007640)[0m     }
[36m(run_dp_rank pid=1007640)[0m }
[36m(run_dp_rank pid=1007640)[0m ========================================
[36m(run_dp_rank pid=1007640)[0m 
[36m(run_dp_rank pid=1007640)[0m Timing and Memory statistics for Actor 1:
[36m(run_dp_rank pid=1007640)[0m   Update:
[36m(run_dp_rank pid=1007640)[0m     total: nan ms
[36m(run_dp_rank pid=1007640)[0m     peak_memory_delta: nan GB
[36m(run_dp_rank pid=1007640)[0m     peak_memory: nan GB
[36m(run_dp_rank pid=1007640)[0m   Stage 1:
[36m(run_dp_rank pid=1007640)[0m     Forward:
[36m(run_dp_rank pid=1007640)[0m       forward: 122.317 ms
[36m(run_dp_rank pid=1007640)[0m       forward_ref: 245.868 ms
[36m(run_dp_rank pid=1007640)[0m       total: 246.380 ms
[36m(run_dp_rank pid=1007640)[0m       peak_memory_delta: nan GB
[36m(run_dp_rank pid=1007640)[0m       peak_memory: nan GB
[36m(run_dp_rank pid=1007640)[0m     Backward:
[36m(run_dp_rank pid=1007640)[0m       backward: 245.517 ms
[36m(run_dp_rank pid=1007640)[0m       backward_ref: 245.765 ms
[36m(run_dp_rank pid=1007640)[0m       total: 245.802 ms
[36m(run_dp_rank pid=1007640)[0m       peak_memory_delta: nan GB
[36m(run_dp_rank pid=1007640)[0m       peak_memory: nan GB
[36m(run_dp_rank pid=1007640)[0m   Stage 3:
[36m(run_dp_rank pid=1007640)[0m     Forward:
[36m(run_dp_rank pid=1007640)[0m       forward: 183.261 ms
[36m(run_dp_rank pid=1007640)[0m       forward_ref: 306.262 ms
[36m(run_dp_rank pid=1007640)[0m       total: 306.952 ms
[36m(run_dp_rank pid=1007640)[0m       peak_memory_delta: nan GB
[36m(run_dp_rank pid=1007640)[0m       peak_memory: nan GB
[36m(run_dp_rank pid=1007640)[0m     Backward:
[36m(run_dp_rank pid=1007640)[0m       backward: 512.701 ms
[36m(run_dp_rank pid=1007640)[0m       backward_ref: 512.885 ms
[36m(run_dp_rank pid=1007640)[0m       total: 512.923 ms
[36m(run_dp_rank pid=1007640)[0m       peak_memory_delta: nan GB
[36m(run_dp_rank pid=1007640)[0m       peak_memory: nan GB
[36m(PiperActor pid=1025870)[0m 2026-02-03 00:31:18,007 - piper_actor - INFO - Actor 1: Tracing disabled
