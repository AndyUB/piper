2026-02-02 21:09:05,963	INFO worker.py:2007 -- Started a local Ray instance.
/m-coriander/coriander/wxdeng/conda-envs/piper_ref/lib/python3.10/site-packages/ray/_private/worker.py:2046: FutureWarning: Tip: In future versions of Ray, Ray will no longer override accelerator visible devices env var if num_gpus=0 or num_gpus=None (default). To enable this behavior and turn off this error message, set RAY_ACCEL_ENV_VAR_OVERRIDE_ON_ZERO=0
  warnings.warn(
session_dir = /home/wxdeng/ray_tmp/ray/session_2026-02-02_21-09-00_475471_740032
logs_dir    = /home/wxdeng/ray_tmp/ray/session_2026-02-02_21-09-00_475471_740032/logs
[36m(PiperProgramCoordinator pid=740858)[0m 2026-02-02 21:09:15,342 - piper_coordinator - INFO - Running program with 1 DP ranks and 2 PP ranks
[36m(run_dp_rank pid=740872)[0m Namespace(model='LLAMA_3B', schedule='interleaved-1f1b', num_stages=4, dp_degree=1, pp_degree=2, batch_size=16, num_mbs=4, seq_len=256, warmup=1, iters=1, tracing=False, verify_weights=False)
[36m(run_dp_rank pid=740872)[0m 2026-02-02 21:09:45,600 - piper_compile - INFO - DP rank 0 compiling 4 stages...
[33m(raylet)[0m WARNING: Device-side CUDA Event completion trace is currently enabled.
[33m(raylet)[0m          This may increase runtime overhead and the likelihood of false
[33m(raylet)[0m          dependencies across CUDA Streams. If you wish to avoid this, please
[33m(raylet)[0m          disable the feature with --cuda-event-trace=false.
[36m(PiperActor pid=758272)[0m 2026-02-02 21:10:12,074 - piper_actor - INFO - Initializing Ray actor 0 global rank 0 with PID: 758272
[33m(raylet)[0m WARNING: Device-side CUDA Event completion trace is currently enabled.
[33m(raylet)[0m          This may increase runtime overhead and the likelihood of false
[33m(raylet)[0m          dependencies across CUDA Streams. If you wish to avoid this, please
[33m(raylet)[0m          disable the feature with --cuda-event-trace=false.
[36m(PiperActor pid=759264)[0m 2026-02-02 21:10:33,103 - piper_actor - INFO - Initializing Ray actor 1 global rank 1 with PID: 759264
[36m(run_dp_rank pid=740872)[0m 2026-02-02 21:11:02,162 - piper_compile - INFO - DP rank 0 joining process groups
[36m(run_dp_rank pid=740872)[0m 2026-02-02 21:11:02,766 - piper_compile - INFO - DP rank 0 completed setup for 2 actors
[36m(run_dp_rank pid=740872)[0m SCHEDULE:
[36m(run_dp_rank pid=740872)[0m 0:0:f	0:1:f	2:0:f	2:1:f	0:2:f	0:3:f	2:0:b	 -- 	2:1:b	2:2:f	0:0:b	2:3:f	0:1:b	 -- 	2:2:b	2:3:b	0:2:b	0:3:b	0:0:u	
[36m(run_dp_rank pid=740872)[0m  -- 	1:0:f	1:1:f	3:0:f	3:0:b	3:1:f	3:1:b	1:2:f	1:0:b	1:3:f	1:1:b	3:2:f	3:2:b	3:3:f	3:3:b	1:2:b	1:3:b	1:0:u	 -- 	
[36m(run_dp_rank pid=740872)[0m 2026-02-02 21:11:03,385 - piper_compile - INFO - DP rank 0 Started NCCL group with 2 actors
[36m(run_dp_rank pid=740872)[0m Running 1 warmup iterations...
[36m(PiperActor pid=758272)[0m 2026-02-02 21:11:03,446 - piper_actor - INFO - Actor 0: Tracing disabled
[33m(raylet)[0m WARNING: Device-side CUDA Event completion trace is currently enabled.
[33m(raylet)[0m          This may increase runtime overhead and the likelihood of false
[33m(raylet)[0m          dependencies across CUDA Streams. If you wish to avoid this, please
[33m(raylet)[0m          disable the feature with --cuda-event-trace=false.
[36m(run_dp_rank pid=740872)[0m Running 1 timed iterations...
[36m(run_dp_rank pid=740872)[0m Iteration time: 6744 ms
[36m(run_dp_rank pid=740872)[0m interleaved-1f1b throughput: 2429 tokens/sec
[36m(run_dp_rank pid=740872)[0m (Force sync) trace data from Actor 0:
[36m(run_dp_rank pid=740872)[0m {
[36m(run_dp_rank pid=740872)[0m     "update": {
[36m(run_dp_rank pid=740872)[0m         "total": [],
[36m(run_dp_rank pid=740872)[0m         "peak_memory_delta": [],
[36m(run_dp_rank pid=740872)[0m         "peak_memory": []
[36m(run_dp_rank pid=740872)[0m     },
[36m(run_dp_rank pid=740872)[0m     "0": {
[36m(run_dp_rank pid=740872)[0m         "forward": {
[36m(run_dp_rank pid=740872)[0m             "forward": [
[36m(run_dp_rank pid=740872)[0m                 122.64329528808594,
[36m(run_dp_rank pid=740872)[0m                 122.80924987792969,
[36m(run_dp_rank pid=740872)[0m                 122.7074203491211,
[36m(run_dp_rank pid=740872)[0m                 123.62198638916016
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "forward_ref": [
[36m(run_dp_rank pid=740872)[0m                 122.91251588612795,
[36m(run_dp_rank pid=740872)[0m                 123.03144298493862,
[36m(run_dp_rank pid=740872)[0m                 122.84545716829598,
[36m(run_dp_rank pid=740872)[0m                 124.07263997010887
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "total": [
[36m(run_dp_rank pid=740872)[0m                 123.81046102382243,
[36m(run_dp_rank pid=740872)[0m                 123.70844883844256,
[36m(run_dp_rank pid=740872)[0m                 123.11628903262317,
[36m(run_dp_rank pid=740872)[0m                 124.95697499252856
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "peak_memory_delta": [],
[36m(run_dp_rank pid=740872)[0m             "peak_memory": []
[36m(run_dp_rank pid=740872)[0m         },
[36m(run_dp_rank pid=740872)[0m         "backward": {
[36m(run_dp_rank pid=740872)[0m             "backward": [
[36m(run_dp_rank pid=740872)[0m                 243.48434448242188,
[36m(run_dp_rank pid=740872)[0m                 246.6627197265625,
[36m(run_dp_rank pid=740872)[0m                 246.39170837402344,
[36m(run_dp_rank pid=740872)[0m                 247.30274963378906
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "backward_ref": [
[36m(run_dp_rank pid=740872)[0m                 489.2663429491222,
[36m(run_dp_rank pid=740872)[0m                 506.9090430624783,
[36m(run_dp_rank pid=740872)[0m                 496.47223204374313,
[36m(run_dp_rank pid=740872)[0m                 247.55660607479513
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "total": [
[36m(run_dp_rank pid=740872)[0m                 489.3123209476471,
[36m(run_dp_rank pid=740872)[0m                 506.95190695114434,
[36m(run_dp_rank pid=740872)[0m                 496.5060518588871,
[36m(run_dp_rank pid=740872)[0m                 247.58868291974068
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "peak_memory_delta": [],
[36m(run_dp_rank pid=740872)[0m             "peak_memory": []
[36m(run_dp_rank pid=740872)[0m         }
[36m(run_dp_rank pid=740872)[0m     },
[36m(run_dp_rank pid=740872)[0m     "2": {
[36m(run_dp_rank pid=740872)[0m         "forward": {
[36m(run_dp_rank pid=740872)[0m             "forward": [
[36m(run_dp_rank pid=740872)[0m                 122.119873046875,
[36m(run_dp_rank pid=740872)[0m                 122.22624206542969,
[36m(run_dp_rank pid=740872)[0m                 122.01590728759766,
[36m(run_dp_rank pid=740872)[0m                 122.04742431640625
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "forward_ref": [
[36m(run_dp_rank pid=740872)[0m                 123.36359708569944,
[36m(run_dp_rank pid=740872)[0m                 123.55832592584193,
[36m(run_dp_rank pid=740872)[0m                 245.16521207988262,
[36m(run_dp_rank pid=740872)[0m                 306.1608150601387
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "total": [
[36m(run_dp_rank pid=740872)[0m                 124.04304696246982,
[36m(run_dp_rank pid=740872)[0m                 123.84171690791845,
[36m(run_dp_rank pid=740872)[0m                 245.74128817766905,
[36m(run_dp_rank pid=740872)[0m                 306.6267380490899
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "peak_memory_delta": [],
[36m(run_dp_rank pid=740872)[0m             "peak_memory": []
[36m(run_dp_rank pid=740872)[0m         },
[36m(run_dp_rank pid=740872)[0m         "backward": {
[36m(run_dp_rank pid=740872)[0m             "backward": [
[36m(run_dp_rank pid=740872)[0m                 242.68173217773438,
[36m(run_dp_rank pid=740872)[0m                 244.63917541503906,
[36m(run_dp_rank pid=740872)[0m                 244.67318725585938,
[36m(run_dp_rank pid=740872)[0m                 244.93939208984375
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "backward_ref": [
[36m(run_dp_rank pid=740872)[0m                 1214.8432568646967,
[36m(run_dp_rank pid=740872)[0m                 618.1858871132135,
[36m(run_dp_rank pid=740872)[0m                 815.0499819312245,
[36m(run_dp_rank pid=740872)[0m                 495.4776740632951
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "total": [
[36m(run_dp_rank pid=740872)[0m                 1214.894562959671,
[36m(run_dp_rank pid=740872)[0m                 618.2182438205928,
[36m(run_dp_rank pid=740872)[0m                 815.078194020316,
[36m(run_dp_rank pid=740872)[0m                 495.51959591917694
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "peak_memory_delta": [],
[36m(run_dp_rank pid=740872)[0m             "peak_memory": []
[36m(run_dp_rank pid=740872)[0m         }
[36m(run_dp_rank pid=740872)[0m     }
[36m(run_dp_rank pid=740872)[0m }
[36m(run_dp_rank pid=740872)[0m ========================================
[36m(run_dp_rank pid=740872)[0m 
[36m(run_dp_rank pid=740872)[0m Timing and Memory statistics for Actor 0:
[36m(run_dp_rank pid=740872)[0m   Update:
[36m(run_dp_rank pid=740872)[0m     total: nan ms
[36m(run_dp_rank pid=740872)[0m     peak_memory_delta: nan GB
[36m(run_dp_rank pid=740872)[0m     peak_memory: nan GB
[36m(run_dp_rank pid=740872)[0m   Stage 0:
[36m(run_dp_rank pid=740872)[0m     Forward:
[36m(run_dp_rank pid=740872)[0m       forward: 122.945 ms
[36m(run_dp_rank pid=740872)[0m       forward_ref: 123.216 ms
[36m(run_dp_rank pid=740872)[0m       total: 123.898 ms
[36m(run_dp_rank pid=740872)[0m       peak_memory_delta: nan GB
[36m(run_dp_rank pid=740872)[0m       peak_memory: nan GB
[36m(run_dp_rank pid=740872)[0m     Backward:
[36m(run_dp_rank pid=740872)[0m       backward: 245.960 ms
[36m(run_dp_rank pid=740872)[0m       backward_ref: 435.051 ms
[36m(run_dp_rank pid=740872)[0m       total: 435.090 ms
[36m(run_dp_rank pid=740872)[0m       peak_memory_delta: nan GB
[36m(run_dp_rank pid=740872)[0m       peak_memory: nan GB
[36m(run_dp_rank pid=740872)[0m   Stage 2:
[36m(run_dp_rank pid=740872)[0m     Forward:
[36m(run_dp_rank pid=740872)[0m       forward: 122.102 ms
[36m(run_dp_rank pid=740872)[0m       forward_ref: 199.562 ms
[36m(run_dp_rank pid=740872)[0m       total: 200.063 ms
[36m(run_dp_rank pid=740872)[0m       peak_memory_delta: nan GB
[36m(run_dp_rank pid=740872)[0m       peak_memory: nan GB
[36m(run_dp_rank pid=740872)[0m     Backward:
[36m(run_dp_rank pid=740872)[0m       backward: 244.233 ms
[36m(run_dp_rank pid=740872)[0m       backward_ref: 785.889 ms
[36m(run_dp_rank pid=740872)[0m       total: 785.928 ms
[36m(run_dp_rank pid=740872)[0m       peak_memory_delta: nan GB
[36m(run_dp_rank pid=740872)[0m       peak_memory: nan GB
[36m(run_dp_rank pid=740872)[0m (Force sync) trace data from Actor 1:
[36m(run_dp_rank pid=740872)[0m {
[36m(run_dp_rank pid=740872)[0m     "update": {
[36m(run_dp_rank pid=740872)[0m         "total": [],
[36m(run_dp_rank pid=740872)[0m         "peak_memory_delta": [],
[36m(run_dp_rank pid=740872)[0m         "peak_memory": []
[36m(run_dp_rank pid=740872)[0m     },
[36m(run_dp_rank pid=740872)[0m     "1": {
[36m(run_dp_rank pid=740872)[0m         "forward": {
[36m(run_dp_rank pid=740872)[0m             "forward": [
[36m(run_dp_rank pid=740872)[0m                 122.43366241455078,
[36m(run_dp_rank pid=740872)[0m                 122.51181030273438,
[36m(run_dp_rank pid=740872)[0m                 122.04198455810547,
[36m(run_dp_rank pid=740872)[0m                 121.99641418457031
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "forward_ref": [
[36m(run_dp_rank pid=740872)[0m                 122.80039885081351,
[36m(run_dp_rank pid=740872)[0m                 122.71727598272264,
[36m(run_dp_rank pid=740872)[0m                 364.8089300841093,
[36m(run_dp_rank pid=740872)[0m                 367.16843699105084
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "total": [
[36m(run_dp_rank pid=740872)[0m                 123.82561294361949,
[36m(run_dp_rank pid=740872)[0m                 123.38930484838784,
[36m(run_dp_rank pid=740872)[0m                 365.5445340555161,
[36m(run_dp_rank pid=740872)[0m                 367.8385131061077
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "peak_memory_delta": [],
[36m(run_dp_rank pid=740872)[0m             "peak_memory": []
[36m(run_dp_rank pid=740872)[0m         },
[36m(run_dp_rank pid=740872)[0m         "backward": {
[36m(run_dp_rank pid=740872)[0m             "backward": [
[36m(run_dp_rank pid=740872)[0m                 243.8500213623047,
[36m(run_dp_rank pid=740872)[0m                 244.48912048339844,
[36m(run_dp_rank pid=740872)[0m                 246.240478515625,
[36m(run_dp_rank pid=740872)[0m                 245.90354919433594
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "backward_ref": [
[36m(run_dp_rank pid=740872)[0m                 244.16596698574722,
[36m(run_dp_rank pid=740872)[0m                 366.4553768467158,
[36m(run_dp_rank pid=740872)[0m                 246.59317499026656,
[36m(run_dp_rank pid=740872)[0m                 246.24901195056736
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "total": [
[36m(run_dp_rank pid=740872)[0m                 244.21259597875178,
[36m(run_dp_rank pid=740872)[0m                 366.5097779594362,
[36m(run_dp_rank pid=740872)[0m                 246.63747008889914,
[36m(run_dp_rank pid=740872)[0m                 246.29264790564775
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "peak_memory_delta": [],
[36m(run_dp_rank pid=740872)[0m             "peak_memory": []
[36m(run_dp_rank pid=740872)[0m         }
[36m(run_dp_rank pid=740872)[0m     },
[36m(run_dp_rank pid=740872)[0m     "3": {
[36m(run_dp_rank pid=740872)[0m         "forward": {
[36m(run_dp_rank pid=740872)[0m             "forward": [
[36m(run_dp_rank pid=740872)[0m                 183.88482666015625,
[36m(run_dp_rank pid=740872)[0m                 183.84329223632812,
[36m(run_dp_rank pid=740872)[0m                 182.89202880859375,
[36m(run_dp_rank pid=740872)[0m                 183.14093017578125
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "forward_ref": [
[36m(run_dp_rank pid=740872)[0m                 184.13711991161108,
[36m(run_dp_rank pid=740872)[0m                 184.04220882803202,
[36m(run_dp_rank pid=740872)[0m                 426.02300900034606,
[36m(run_dp_rank pid=740872)[0m                 362.78231791220605
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "total": [
[36m(run_dp_rank pid=740872)[0m                 185.04770286381245,
[36m(run_dp_rank pid=740872)[0m                 184.5490529667586,
[36m(run_dp_rank pid=740872)[0m                 426.71193298883736,
[36m(run_dp_rank pid=740872)[0m                 363.8149530161172
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "peak_memory_delta": [],
[36m(run_dp_rank pid=740872)[0m             "peak_memory": []
[36m(run_dp_rank pid=740872)[0m         },
[36m(run_dp_rank pid=740872)[0m         "backward": {
[36m(run_dp_rank pid=740872)[0m             "backward": [
[36m(run_dp_rank pid=740872)[0m                 381.572265625,
[36m(run_dp_rank pid=740872)[0m                 776.39794921875,
[36m(run_dp_rank pid=740872)[0m                 382.2824401855469,
[36m(run_dp_rank pid=740872)[0m                 379.52813720703125
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "backward_ref": [
[36m(run_dp_rank pid=740872)[0m                 381.7604840733111,
[36m(run_dp_rank pid=740872)[0m                 776.673706015572,
[36m(run_dp_rank pid=740872)[0m                 382.4940240010619,
[36m(run_dp_rank pid=740872)[0m                 379.72091301344335
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "total": [
[36m(run_dp_rank pid=740872)[0m                 381.8621861282736,
[36m(run_dp_rank pid=740872)[0m                 776.7574908211827,
[36m(run_dp_rank pid=740872)[0m                 382.52802519127727,
[36m(run_dp_rank pid=740872)[0m                 379.7626351006329
[36m(run_dp_rank pid=740872)[0m             ],
[36m(run_dp_rank pid=740872)[0m             "peak_memory_delta": [],
[36m(run_dp_rank pid=740872)[0m             "peak_memory": []
[36m(run_dp_rank pid=740872)[0m         }
[36m(run_dp_rank pid=740872)[0m     }
[36m(run_dp_rank pid=740872)[0m }
[36m(run_dp_rank pid=740872)[0m ========================================
[36m(run_dp_rank pid=740872)[0m 
[36m(run_dp_rank pid=740872)[0m Timing and Memory statistics for Actor 1:
[36m(run_dp_rank pid=740872)[0m   Update:
[36m(run_dp_rank pid=740872)[0m     total: nan ms
[36m(run_dp_rank pid=740872)[0m     peak_memory_delta: nan GB
[36m(run_dp_rank pid=740872)[0m     peak_memory: nan GB
[36m(run_dp_rank pid=740872)[0m   Stage 1:
[36m(run_dp_rank pid=740872)[0m     Forward:
[36m(run_dp_rank pid=740872)[0m       forward: 122.246 ms
[36m(run_dp_rank pid=740872)[0m       forward_ref: 244.374 ms
[36m(run_dp_rank pid=740872)[0m       total: 245.149 ms
[36m(run_dp_rank pid=740872)[0m       peak_memory_delta: nan GB
[36m(run_dp_rank pid=740872)[0m       peak_memory: nan GB
[36m(run_dp_rank pid=740872)[0m     Backward:
[36m(run_dp_rank pid=740872)[0m       backward: 245.121 ms
[36m(run_dp_rank pid=740872)[0m       backward_ref: 275.866 ms
[36m(run_dp_rank pid=740872)[0m       total: 275.913 ms
[36m(run_dp_rank pid=740872)[0m       peak_memory_delta: nan GB
[36m(run_dp_rank pid=740872)[0m       peak_memory: nan GB
[36m(run_dp_rank pid=740872)[0m   Stage 3:
[36m(run_dp_rank pid=740872)[0m     Forward:
[36m(run_dp_rank pid=740872)[0m       forward: 183.440 ms
[36m(run_dp_rank pid=740872)[0m       forward_ref: 289.246 ms
[36m(run_dp_rank pid=740872)[0m       total: 290.031 ms
[36m(run_dp_rank pid=740872)[0m       peak_memory_delta: nan GB
[36m(run_dp_rank pid=740872)[0m       peak_memory: nan GB
[36m(run_dp_rank pid=740872)[0m     Backward:
[36m(run_dp_rank pid=740872)[0m       backward: 479.945 ms
[36m(run_dp_rank pid=740872)[0m       backward_ref: 480.162 ms
[36m(run_dp_rank pid=740872)[0m       total: 480.228 ms
[36m(run_dp_rank pid=740872)[0m       peak_memory_delta: nan GB
[36m(run_dp_rank pid=740872)[0m       peak_memory: nan GB
[36m(PiperActor pid=759264)[0m 2026-02-02 21:11:03,446 - piper_actor - INFO - Actor 1: Tracing disabled
