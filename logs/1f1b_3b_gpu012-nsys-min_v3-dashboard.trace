2026-01-28 21:54:46,179	INFO worker.py:1998 -- Started a local Ray instance. View the dashboard at [1m[32m127.0.0.1:11015 [39m[22m
/m-coriander/coriander/wxdeng/conda-envs/piper_ref/lib/python3.10/site-packages/ray/_private/worker.py:2046: FutureWarning: Tip: In future versions of Ray, Ray will no longer override accelerator visible devices env var if num_gpus=0 or num_gpus=None (default). To enable this behavior and turn off this error message, set RAY_ACCEL_ENV_VAR_OVERRIDE_ON_ZERO=0
  warnings.warn(
session_dir = /home/wxdeng/ray_tmp/ray/session_2026-01-28_21-54-38_953909_2070520
logs_dir    = /home/wxdeng/ray_tmp/ray/session_2026-01-28_21-54-38_953909_2070520/logs
[36m(PiperProgramCoordinator pid=2071926)[0m 2026-01-28 21:54:55,801 - piper_coordinator - INFO - Running program with 1 DP ranks and 2 PP ranks
[36m(run_dp_rank pid=2071937)[0m Namespace(model='LLAMA_3B', schedule='1f1b', num_stages=2, dp_degree=1, pp_degree=2, batch_size=16, num_mbs=4, seq_len=256, warmup=1, iters=1, tracing=True, verify_weights=False)
[36m(run_dp_rank pid=2071937)[0m 2026-01-28 21:55:36,466 - piper_compile - INFO - DP rank 0 compiling 2 stages...
[33m(raylet)[0m WARNING: Device-side CUDA Event completion trace is currently enabled.
[33m(raylet)[0m          This may increase runtime overhead and the likelihood of false
[33m(raylet)[0m          dependencies across CUDA Streams. If you wish to avoid this, please
[33m(raylet)[0m          disable the feature with --cuda-event-trace=false.
[36m(PiperActor pid=2091041)[0m 2026-01-28 21:56:18,651 - piper_actor - INFO - Initializing Ray actor 0 global rank 0 with PID: 2091041
[33m(raylet)[0m WARNING: Device-side CUDA Event completion trace is currently enabled.
[33m(raylet)[0m          This may increase runtime overhead and the likelihood of false
[33m(raylet)[0m          dependencies across CUDA Streams. If you wish to avoid this, please
[33m(raylet)[0m          disable the feature with --cuda-event-trace=false.
[36m(PiperActor pid=2092891)[0m 2026-01-28 21:57:01,350 - piper_actor - INFO - Initializing Ray actor 1 global rank 1 with PID: 2092891
[36m(run_dp_rank pid=2071937)[0m 2026-01-28 21:57:34,769 - piper_compile - INFO - DP rank 0 joining process groups
[36m(run_dp_rank pid=2071937)[0m 2026-01-28 21:57:34,792 - piper_compile - INFO - DP rank 0 completed setup for 2 actors
[36m(run_dp_rank pid=2071937)[0m SCHEDULE:
[36m(run_dp_rank pid=2071937)[0m 0:0:f	0:1:f	0:2:f	0:0:b	0:3:f	0:1:b	 -- 	0:2:b	 -- 	0:3:b	0:3:u	
[36m(run_dp_rank pid=2071937)[0m  -- 	1:0:f	1:0:b	1:1:f	1:1:b	1:2:f	1:2:b	1:3:f	1:3:b	1:3:u	 -- 	
[36m(run_dp_rank pid=2071937)[0m 2026-01-28 21:57:35,426 - piper_compile - INFO - DP rank 0 Started NCCL group with 2 actors
[36m(run_dp_rank pid=2071937)[0m Running 1 warmup iterations...
[36m(PiperActor pid=2091041)[0m 2026-01-28 21:57:35,474 - piper_actor - INFO - Actor 0: Tracing enabled
[33m(raylet)[0m WARNING: Device-side CUDA Event completion trace is currently enabled.
[33m(raylet)[0m          This may increase runtime overhead and the likelihood of false
[33m(raylet)[0m          dependencies across CUDA Streams. If you wish to avoid this, please
[33m(raylet)[0m          disable the feature with --cuda-event-trace=false.
[36m(run_dp_rank pid=2071937)[0m Running 1 timed iterations...
[36m(run_dp_rank pid=2071937)[0m Iteration time: 5749 ms
[36m(run_dp_rank pid=2071937)[0m 1f1b throughput: 2850 tokens/sec
[36m(run_dp_rank pid=2071937)[0m Peak memory:
[36m(run_dp_rank pid=2071937)[0m 	Actor 0: 48.8 GB
[36m(run_dp_rank pid=2071937)[0m 	Actor 1: 58.9 GB
[36m(run_dp_rank pid=2071937)[0m ========================================
[36m(run_dp_rank pid=2071937)[0m Raw trace data from Actor 0:
[36m(run_dp_rank pid=2071937)[0m {
[36m(run_dp_rank pid=2071937)[0m     "update": {
[36m(run_dp_rank pid=2071937)[0m         "total": [
[36m(run_dp_rank pid=2071937)[0m             43.75094223022461
[36m(run_dp_rank pid=2071937)[0m         ],
[36m(run_dp_rank pid=2071937)[0m         "peak_memory_delta": [
[36m(run_dp_rank pid=2071937)[0m             6.6721954345703125
[36m(run_dp_rank pid=2071937)[0m         ],
[36m(run_dp_rank pid=2071937)[0m         "peak_memory": [
[36m(run_dp_rank pid=2071937)[0m             48.76802062988281
[36m(run_dp_rank pid=2071937)[0m         ]
[36m(run_dp_rank pid=2071937)[0m     },
[36m(run_dp_rank pid=2071937)[0m     "0": {
[36m(run_dp_rank pid=2071937)[0m         "forward": {
[36m(run_dp_rank pid=2071937)[0m             "forward": [
[36m(run_dp_rank pid=2071937)[0m                 245.1643829345703,
[36m(run_dp_rank pid=2071937)[0m                 244.96067810058594,
[36m(run_dp_rank pid=2071937)[0m                 244.99717712402344,
[36m(run_dp_rank pid=2071937)[0m                 624.20458984375
[36m(run_dp_rank pid=2071937)[0m             ],
[36m(run_dp_rank pid=2071937)[0m             "total": [
[36m(run_dp_rank pid=2071937)[0m                 245.1643829345703,
[36m(run_dp_rank pid=2071937)[0m                 244.96067810058594,
[36m(run_dp_rank pid=2071937)[0m                 244.99717712402344,
[36m(run_dp_rank pid=2071937)[0m                 624.20458984375
[36m(run_dp_rank pid=2071937)[0m             ],
[36m(run_dp_rank pid=2071937)[0m             "peak_memory_delta": [
[36m(run_dp_rank pid=2071937)[0m                 14.96917724609375,
[36m(run_dp_rank pid=2071937)[0m                 14.96917724609375,
[36m(run_dp_rank pid=2071937)[0m                 14.96917724609375,
[36m(run_dp_rank pid=2071937)[0m                 14.96917724609375
[36m(run_dp_rank pid=2071937)[0m             ],
[36m(run_dp_rank pid=2071937)[0m             "peak_memory": [
[36m(run_dp_rank pid=2071937)[0m                 50.15846252441406,
[36m(run_dp_rank pid=2071937)[0m                 65.08079528808594,
[36m(run_dp_rank pid=2071937)[0m                 80.00312805175781,
[36m(run_dp_rank pid=2071937)[0m                 86.76907348632812
[36m(run_dp_rank pid=2071937)[0m             ]
[36m(run_dp_rank pid=2071937)[0m         },
[36m(run_dp_rank pid=2071937)[0m         "backward": {
[36m(run_dp_rank pid=2071937)[0m             "backward": [
[36m(run_dp_rank pid=2071937)[0m                 833.396240234375,
[36m(run_dp_rank pid=2071937)[0m                 524.6271362304688,
[36m(run_dp_rank pid=2071937)[0m                 493.9320068359375,
[36m(run_dp_rank pid=2071937)[0m                 493.7486572265625
[36m(run_dp_rank pid=2071937)[0m             ],
[36m(run_dp_rank pid=2071937)[0m             "total": [
[36m(run_dp_rank pid=2071937)[0m                 834.5232543945312,
[36m(run_dp_rank pid=2071937)[0m                 526.048583984375,
[36m(run_dp_rank pid=2071937)[0m                 496.1290588378906,
[36m(run_dp_rank pid=2071937)[0m                 494.7435302734375
[36m(run_dp_rank pid=2071937)[0m             ],
[36m(run_dp_rank pid=2071937)[0m             "peak_memory_delta": [
[36m(run_dp_rank pid=2071937)[0m                 0.34375,
[36m(run_dp_rank pid=2071937)[0m                 0.25,
[36m(run_dp_rank pid=2071937)[0m                 0.25,
[36m(run_dp_rank pid=2071937)[0m                 0.25
[36m(run_dp_rank pid=2071937)[0m             ],
[36m(run_dp_rank pid=2071937)[0m             "peak_memory": [
[36m(run_dp_rank pid=2071937)[0m                 80.34687805175781,
[36m(run_dp_rank pid=2071937)[0m                 87.01907348632812,
[36m(run_dp_rank pid=2071937)[0m                 72.14361572265625,
[36m(run_dp_rank pid=2071937)[0m                 57.268157958984375
[36m(run_dp_rank pid=2071937)[0m             ]
[36m(run_dp_rank pid=2071937)[0m         }
[36m(run_dp_rank pid=2071937)[0m     }
[36m(run_dp_rank pid=2071937)[0m }
[36m(run_dp_rank pid=2071937)[0m ========================================
[36m(run_dp_rank pid=2071937)[0m 
[36m(run_dp_rank pid=2071937)[0m Timing and Memory statistics for Actor 0:
[36m(run_dp_rank pid=2071937)[0m   Update:
[36m(run_dp_rank pid=2071937)[0m     total: 43.751 ms
[36m(run_dp_rank pid=2071937)[0m     peak_memory_delta: 6.672 GB
[36m(run_dp_rank pid=2071937)[0m     peak_memory: 48.768 GB
[36m(run_dp_rank pid=2071937)[0m   Stage 0:
[36m(run_dp_rank pid=2071937)[0m     Forward:
[36m(run_dp_rank pid=2071937)[0m       forward: 339.832 ms
[36m(run_dp_rank pid=2071937)[0m       total: 339.832 ms
[36m(run_dp_rank pid=2071937)[0m       peak_memory_delta: 14.969 GB
[36m(run_dp_rank pid=2071937)[0m       peak_memory: 70.503 GB
[36m(run_dp_rank pid=2071937)[0m     Backward:
[36m(run_dp_rank pid=2071937)[0m       backward: 586.426 ms
[36m(run_dp_rank pid=2071937)[0m       total: 587.861 ms
[36m(run_dp_rank pid=2071937)[0m       peak_memory_delta: 0.273 GB
[36m(run_dp_rank pid=2071937)[0m       peak_memory: 74.194 GB
[36m(run_dp_rank pid=2071937)[0m Raw trace data from Actor 1:
[36m(run_dp_rank pid=2071937)[0m {
[36m(run_dp_rank pid=2071937)[0m     "update": {
[36m(run_dp_rank pid=2071937)[0m         "total": [
[36m(run_dp_rank pid=2071937)[0m             39.921791076660156
[36m(run_dp_rank pid=2071937)[0m         ],
[36m(run_dp_rank pid=2071937)[0m         "peak_memory_delta": [
[36m(run_dp_rank pid=2071937)[0m             4.761074066162109
[36m(run_dp_rank pid=2071937)[0m         ],
[36m(run_dp_rank pid=2071937)[0m         "peak_memory": [
[36m(run_dp_rank pid=2071937)[0m             58.89303207397461
[36m(run_dp_rank pid=2071937)[0m         ]
[36m(run_dp_rank pid=2071937)[0m     },
[36m(run_dp_rank pid=2071937)[0m     "1": {
[36m(run_dp_rank pid=2071937)[0m         "forward": {
[36m(run_dp_rank pid=2071937)[0m             "forward": [
[36m(run_dp_rank pid=2071937)[0m                 305.56878662109375,
[36m(run_dp_rank pid=2071937)[0m                 340.09527587890625,
[36m(run_dp_rank pid=2071937)[0m                 305.0188903808594,
[36m(run_dp_rank pid=2071937)[0m                 305.78973388671875
[36m(run_dp_rank pid=2071937)[0m             ],
[36m(run_dp_rank pid=2071937)[0m             "total": [
[36m(run_dp_rank pid=2071937)[0m                 305.56878662109375,
[36m(run_dp_rank pid=2071937)[0m                 340.09527587890625,
[36m(run_dp_rank pid=2071937)[0m                 305.0188903808594,
[36m(run_dp_rank pid=2071937)[0m                 305.78973388671875
[36m(run_dp_rank pid=2071937)[0m             ],
[36m(run_dp_rank pid=2071937)[0m             "peak_memory_delta": [
[36m(run_dp_rank pid=2071937)[0m                 16.926223754882812,
[36m(run_dp_rank pid=2071937)[0m                 16.926223754882812,
[36m(run_dp_rank pid=2071937)[0m                 16.926223754882812,
[36m(run_dp_rank pid=2071937)[0m                 16.926223754882812
[36m(run_dp_rank pid=2071937)[0m             ],
[36m(run_dp_rank pid=2071937)[0m             "peak_memory": [
[36m(run_dp_rank pid=2071937)[0m                 56.5119514465332,
[36m(run_dp_rank pid=2071937)[0m                 65.18708801269531,
[36m(run_dp_rank pid=2071937)[0m                 67.14411926269531,
[36m(run_dp_rank pid=2071937)[0m                 69.10115051269531
[36m(run_dp_rank pid=2071937)[0m             ]
[36m(run_dp_rank pid=2071937)[0m         },
[36m(run_dp_rank pid=2071937)[0m         "backward": {
[36m(run_dp_rank pid=2071937)[0m             "backward": [
[36m(run_dp_rank pid=2071937)[0m                 726.7781982421875,
[36m(run_dp_rank pid=2071937)[0m                 632.7909545898438,
[36m(run_dp_rank pid=2071937)[0m                 856.2888793945312,
[36m(run_dp_rank pid=2071937)[0m                 935.333740234375
[36m(run_dp_rank pid=2071937)[0m             ],
[36m(run_dp_rank pid=2071937)[0m             "total": [
[36m(run_dp_rank pid=2071937)[0m                 728.2855834960938,
[36m(run_dp_rank pid=2071937)[0m                 634.0197143554688,
[36m(run_dp_rank pid=2071937)[0m                 858.0488891601562,
[36m(run_dp_rank pid=2071937)[0m                 936.783447265625
[36m(run_dp_rank pid=2071937)[0m             ],
[36m(run_dp_rank pid=2071937)[0m             "peak_memory_delta": [
[36m(run_dp_rank pid=2071937)[0m                 5.871094703674316,
[36m(run_dp_rank pid=2071937)[0m                 5.871094703674316,
[36m(run_dp_rank pid=2071937)[0m                 5.871094703674316,
[36m(run_dp_rank pid=2071937)[0m                 5.871094703674316
[36m(run_dp_rank pid=2071937)[0m             ],
[36m(run_dp_rank pid=2071937)[0m             "peak_memory": [
[36m(run_dp_rank pid=2071937)[0m                 62.33617115020752,
[36m(run_dp_rank pid=2071937)[0m                 71.01130771636963,
[36m(run_dp_rank pid=2071937)[0m                 72.96833896636963,
[36m(run_dp_rank pid=2071937)[0m                 74.92537021636963
[36m(run_dp_rank pid=2071937)[0m             ]
[36m(run_dp_rank pid=2071937)[0m         }
[36m(run_dp_rank pid=2071937)[0m     }
[36m(run_dp_rank pid=2071937)[0m }
[36m(run_dp_rank pid=2071937)[0m ========================================
[36m(run_dp_rank pid=2071937)[0m 
[36m(run_dp_rank pid=2071937)[0m Timing and Memory statistics for Actor 1:
[36m(run_dp_rank pid=2071937)[0m   Update:
[36m(run_dp_rank pid=2071937)[0m     total: 39.922 ms
[36m(run_dp_rank pid=2071937)[0m     peak_memory_delta: 4.761 GB
[36m(run_dp_rank pid=2071937)[0m     peak_memory: 58.893 GB
[36m(run_dp_rank pid=2071937)[0m   Stage 1:
[36m(run_dp_rank pid=2071937)[0m     Forward:
[36m(run_dp_rank pid=2071937)[0m       forward: 314.118 ms
[36m(run_dp_rank pid=2071937)[0m       total: 314.118 ms
[36m(run_dp_rank pid=2071937)[0m       peak_memory_delta: 16.926 GB
[36m(run_dp_rank pid=2071937)[0m       peak_memory: 64.486 GB
[36m(run_dp_rank pid=2071937)[0m     Backward:
[36m(run_dp_rank pid=2071937)[0m       backward: 787.798 ms
[36m(run_dp_rank pid=2071937)[0m       total: 789.284 ms
[36m(run_dp_rank pid=2071937)[0m       peak_memory_delta: 5.871 GB
[36m(run_dp_rank pid=2071937)[0m       peak_memory: 70.310 GB
[36m(PiperActor pid=2091041)[0m [rank0]:[W128 21:58:10.201026489 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())
[36m(PiperActor pid=2092891)[0m 2026-01-28 21:57:35,474 - piper_actor - INFO - Actor 1: Tracing enabled
Traceback (most recent call last):
  File "/m-coriander/coriander/wxdeng/conda-envs/piper_ref/lib/python3.10/runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/m-coriander/coriander/wxdeng/conda-envs/piper_ref/lib/python3.10/runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "/m-coriander/coriander/wxdeng/mlsys/piper_ref/test/test_llama.py", line 292, in <module>
    time.sleep(3600)
KeyboardInterrupt
[36m(PiperActor pid=2092891)[0m [rank1]:[W128 21:58:10.198484852 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())
