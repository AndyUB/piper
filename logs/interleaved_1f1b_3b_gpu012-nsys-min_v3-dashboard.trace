2026-01-28 21:49:34,214	INFO worker.py:1998 -- Started a local Ray instance. View the dashboard at [1m[32m127.0.0.1:11015 [39m[22m
/m-coriander/coriander/wxdeng/conda-envs/piper_ref/lib/python3.10/site-packages/ray/_private/worker.py:2046: FutureWarning: Tip: In future versions of Ray, Ray will no longer override accelerator visible devices env var if num_gpus=0 or num_gpus=None (default). To enable this behavior and turn off this error message, set RAY_ACCEL_ENV_VAR_OVERRIDE_ON_ZERO=0
  warnings.warn(
session_dir = /home/wxdeng/ray_tmp/ray/session_2026-01-28_21-49-27_463130_2041990
logs_dir    = /home/wxdeng/ray_tmp/ray/session_2026-01-28_21-49-27_463130_2041990/logs
[36m(PiperProgramCoordinator pid=2043250)[0m 2026-01-28 21:49:43,853 - piper_coordinator - INFO - Running program with 1 DP ranks and 2 PP ranks
[36m(run_dp_rank pid=2043249)[0m Namespace(model='LLAMA_3B', schedule='interleaved-1f1b', num_stages=4, dp_degree=1, pp_degree=2, batch_size=16, num_mbs=4, seq_len=256, warmup=1, iters=1, tracing=True, verify_weights=False)
[36m(run_dp_rank pid=2043249)[0m 2026-01-28 21:50:14,543 - piper_compile - INFO - DP rank 0 compiling 4 stages...
[33m(raylet)[0m WARNING: Device-side CUDA Event completion trace is currently enabled.
[33m(raylet)[0m          This may increase runtime overhead and the likelihood of false
[33m(raylet)[0m          dependencies across CUDA Streams. If you wish to avoid this, please
[33m(raylet)[0m          disable the feature with --cuda-event-trace=false.
[36m(PiperActor pid=2061066)[0m 2026-01-28 21:50:50,189 - piper_actor - INFO - Initializing Ray actor 0 global rank 0 with PID: 2061066
[33m(raylet)[0m WARNING: Device-side CUDA Event completion trace is currently enabled.
[33m(raylet)[0m          This may increase runtime overhead and the likelihood of false
[33m(raylet)[0m          dependencies across CUDA Streams. If you wish to avoid this, please
[33m(raylet)[0m          disable the feature with --cuda-event-trace=false.
[36m(PiperActor pid=2062326)[0m 2026-01-28 21:51:14,764 - piper_actor - INFO - Initializing Ray actor 1 global rank 1 with PID: 2062326
[36m(run_dp_rank pid=2043249)[0m 2026-01-28 21:51:57,283 - piper_compile - INFO - DP rank 0 joining process groups
[36m(run_dp_rank pid=2043249)[0m 2026-01-28 21:51:57,760 - piper_compile - INFO - DP rank 0 completed setup for 2 actors
[36m(run_dp_rank pid=2043249)[0m SCHEDULE:
[36m(run_dp_rank pid=2043249)[0m 0:0:f	0:1:f	2:0:f	2:1:f	0:2:f	0:3:f	2:0:b	 -- 	2:1:b	2:2:f	0:0:b	2:3:f	0:1:b	 -- 	2:2:b	2:3:b	0:2:b	0:3:b	0:0:u	
[36m(run_dp_rank pid=2043249)[0m  -- 	1:0:f	1:1:f	3:0:f	3:0:b	3:1:f	3:1:b	1:2:f	1:0:b	1:3:f	1:1:b	3:2:f	3:2:b	3:3:f	3:3:b	1:2:b	1:3:b	1:0:u	 -- 	
[36m(run_dp_rank pid=2043249)[0m Running 1 warmup iterations...
[36m(run_dp_rank pid=2043249)[0m 2026-01-28 21:51:58,427 - piper_compile - INFO - DP rank 0 Started NCCL group with 2 actors
[36m(PiperActor pid=2061066)[0m 2026-01-28 21:51:58,470 - piper_actor - INFO - Actor 0: Tracing enabled
[33m(raylet)[0m WARNING: Device-side CUDA Event completion trace is currently enabled.
[33m(raylet)[0m          This may increase runtime overhead and the likelihood of false
[33m(raylet)[0m          dependencies across CUDA Streams. If you wish to avoid this, please
[33m(raylet)[0m          disable the feature with --cuda-event-trace=false.
[36m(run_dp_rank pid=2043249)[0m Running 1 timed iterations...
[36m(run_dp_rank pid=2043249)[0m Iteration time: 6753 ms
[36m(run_dp_rank pid=2043249)[0m interleaved-1f1b throughput: 2426 tokens/sec
[36m(run_dp_rank pid=2043249)[0m Peak memory:
[36m(run_dp_rank pid=2043249)[0m 	Actor 0: 46.8 GB
[36m(run_dp_rank pid=2043249)[0m 	Actor 1: 57.4 GB
[36m(run_dp_rank pid=2043249)[0m ========================================
[36m(run_dp_rank pid=2043249)[0m Raw trace data from Actor 0:
[36m(run_dp_rank pid=2043249)[0m {
[36m(run_dp_rank pid=2043249)[0m     "update": {
[36m(run_dp_rank pid=2043249)[0m         "total": [
[36m(run_dp_rank pid=2043249)[0m             40.79536056518555
[36m(run_dp_rank pid=2043249)[0m         ],
[36m(run_dp_rank pid=2043249)[0m         "peak_memory_delta": [
[36m(run_dp_rank pid=2043249)[0m             4.000160217285156
[36m(run_dp_rank pid=2043249)[0m         ],
[36m(run_dp_rank pid=2043249)[0m         "peak_memory": [
[36m(run_dp_rank pid=2043249)[0m             46.799415588378906
[36m(run_dp_rank pid=2043249)[0m         ]
[36m(run_dp_rank pid=2043249)[0m     },
[36m(run_dp_rank pid=2043249)[0m     "0": {
[36m(run_dp_rank pid=2043249)[0m         "forward": {
[36m(run_dp_rank pid=2043249)[0m             "forward": [
[36m(run_dp_rank pid=2043249)[0m                 122.66627502441406,
[36m(run_dp_rank pid=2043249)[0m                 122.89778900146484,
[36m(run_dp_rank pid=2043249)[0m                 163.8210906982422,
[36m(run_dp_rank pid=2043249)[0m                 123.76668548583984
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "total": [
[36m(run_dp_rank pid=2043249)[0m                 122.66627502441406,
[36m(run_dp_rank pid=2043249)[0m                 122.89778900146484,
[36m(run_dp_rank pid=2043249)[0m                 163.8210906982422,
[36m(run_dp_rank pid=2043249)[0m                 123.76668548583984
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "peak_memory_delta": [
[36m(run_dp_rank pid=2043249)[0m                 7.531463623046875,
[36m(run_dp_rank pid=2043249)[0m                 7.531463623046875,
[36m(run_dp_rank pid=2043249)[0m                 7.531463623046875,
[36m(run_dp_rank pid=2043249)[0m                 7.531463623046875
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "peak_memory": [
[36m(run_dp_rank pid=2043249)[0m                 43.23667907714844,
[36m(run_dp_rank pid=2043249)[0m                 50.72129821777344,
[36m(run_dp_rank pid=2043249)[0m                 72.98759460449219,
[36m(run_dp_rank pid=2043249)[0m                 80.47221374511719
[36m(run_dp_rank pid=2043249)[0m             ]
[36m(run_dp_rank pid=2043249)[0m         },
[36m(run_dp_rank pid=2043249)[0m         "backward": {
[36m(run_dp_rank pid=2043249)[0m             "backward": [
[36m(run_dp_rank pid=2043249)[0m                 243.2191925048828,
[36m(run_dp_rank pid=2043249)[0m                 246.43289184570312,
[36m(run_dp_rank pid=2043249)[0m                 246.45138549804688,
[36m(run_dp_rank pid=2043249)[0m                 247.9885711669922
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "total": [
[36m(run_dp_rank pid=2043249)[0m                 244.0015411376953,
[36m(run_dp_rank pid=2043249)[0m                 247.22886657714844,
[36m(run_dp_rank pid=2043249)[0m                 247.19564819335938,
[36m(run_dp_rank pid=2043249)[0m                 248.95513916015625
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "peak_memory_delta": [
[36m(run_dp_rank pid=2043249)[0m                 0.34375,
[36m(run_dp_rank pid=2043249)[0m                 0.25,
[36m(run_dp_rank pid=2043249)[0m                 0.25,
[36m(run_dp_rank pid=2043249)[0m                 0.25
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "peak_memory": [
[36m(run_dp_rank pid=2043249)[0m                 76.14403533935547,
[36m(run_dp_rank pid=2043249)[0m                 80.0972900390625,
[36m(run_dp_rank pid=2043249)[0m                 57.97161865234375,
[36m(run_dp_rank pid=2043249)[0m                 50.53387451171875
[36m(run_dp_rank pid=2043249)[0m             ]
[36m(run_dp_rank pid=2043249)[0m         }
[36m(run_dp_rank pid=2043249)[0m     },
[36m(run_dp_rank pid=2043249)[0m     "2": {
[36m(run_dp_rank pid=2043249)[0m         "forward": {
[36m(run_dp_rank pid=2043249)[0m             "forward": [
[36m(run_dp_rank pid=2043249)[0m                 122.24883270263672,
[36m(run_dp_rank pid=2043249)[0m                 122.727294921875,
[36m(run_dp_rank pid=2043249)[0m                 122.81267547607422,
[36m(run_dp_rank pid=2043249)[0m                 122.09622192382812
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "total": [
[36m(run_dp_rank pid=2043249)[0m                 122.24883270263672,
[36m(run_dp_rank pid=2043249)[0m                 122.727294921875,
[36m(run_dp_rank pid=2043249)[0m                 122.81267547607422,
[36m(run_dp_rank pid=2043249)[0m                 122.09622192382812
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "peak_memory_delta": [
[36m(run_dp_rank pid=2043249)[0m                 7.484588623046875,
[36m(run_dp_rank pid=2043249)[0m                 7.484588623046875,
[36m(run_dp_rank pid=2043249)[0m                 7.484588623046875,
[36m(run_dp_rank pid=2043249)[0m                 7.484588623046875
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "peak_memory": [
[36m(run_dp_rank pid=2043249)[0m                 58.15901184082031,
[36m(run_dp_rank pid=2043249)[0m                 65.54985046386719,
[36m(run_dp_rank pid=2043249)[0m                 75.84716033935547,
[36m(run_dp_rank pid=2043249)[0m                 79.8941650390625
[36m(run_dp_rank pid=2043249)[0m             ]
[36m(run_dp_rank pid=2043249)[0m         },
[36m(run_dp_rank pid=2043249)[0m         "backward": {
[36m(run_dp_rank pid=2043249)[0m             "backward": [
[36m(run_dp_rank pid=2043249)[0m                 242.5061492919922,
[36m(run_dp_rank pid=2043249)[0m                 244.5979461669922,
[36m(run_dp_rank pid=2043249)[0m                 244.7605438232422,
[36m(run_dp_rank pid=2043249)[0m                 244.68272399902344
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "total": [
[36m(run_dp_rank pid=2043249)[0m                 244.234375,
[36m(run_dp_rank pid=2043249)[0m                 245.34886169433594,
[36m(run_dp_rank pid=2043249)[0m                 246.12351989746094,
[36m(run_dp_rank pid=2043249)[0m                 245.58412170410156
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "peak_memory_delta": [
[36m(run_dp_rank pid=2043249)[0m                 0.34375,
[36m(run_dp_rank pid=2043249)[0m                 0.25,
[36m(run_dp_rank pid=2043249)[0m                 0.25,
[36m(run_dp_rank pid=2043249)[0m                 0.25
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "peak_memory": [
[36m(run_dp_rank pid=2043249)[0m                 80.81596374511719,
[36m(run_dp_rank pid=2043249)[0m                 76.00341033935547,
[36m(run_dp_rank pid=2043249)[0m                 72.6595458984375,
[36m(run_dp_rank pid=2043249)[0m                 65.31558227539062
[36m(run_dp_rank pid=2043249)[0m             ]
[36m(run_dp_rank pid=2043249)[0m         }
[36m(run_dp_rank pid=2043249)[0m     }
[36m(run_dp_rank pid=2043249)[0m }
[36m(run_dp_rank pid=2043249)[0m ========================================
[36m(run_dp_rank pid=2043249)[0m 
[36m(run_dp_rank pid=2043249)[0m Timing and Memory statistics for Actor 0:
[36m(run_dp_rank pid=2043249)[0m   Update:
[36m(run_dp_rank pid=2043249)[0m     total: 40.795 ms
[36m(run_dp_rank pid=2043249)[0m     peak_memory_delta: 4.000 GB
[36m(run_dp_rank pid=2043249)[0m     peak_memory: 46.799 GB
[36m(run_dp_rank pid=2043249)[0m   Stage 0:
[36m(run_dp_rank pid=2043249)[0m     Forward:
[36m(run_dp_rank pid=2043249)[0m       forward: 133.288 ms
[36m(run_dp_rank pid=2043249)[0m       total: 133.288 ms
[36m(run_dp_rank pid=2043249)[0m       peak_memory_delta: 7.531 GB
[36m(run_dp_rank pid=2043249)[0m       peak_memory: 61.854 GB
[36m(run_dp_rank pid=2043249)[0m     Backward:
[36m(run_dp_rank pid=2043249)[0m       backward: 246.023 ms
[36m(run_dp_rank pid=2043249)[0m       total: 246.845 ms
[36m(run_dp_rank pid=2043249)[0m       peak_memory_delta: 0.273 GB
[36m(run_dp_rank pid=2043249)[0m       peak_memory: 66.187 GB
[36m(run_dp_rank pid=2043249)[0m   Stage 2:
[36m(run_dp_rank pid=2043249)[0m     Forward:
[36m(run_dp_rank pid=2043249)[0m       forward: 122.471 ms
[36m(run_dp_rank pid=2043249)[0m       total: 122.471 ms
[36m(run_dp_rank pid=2043249)[0m       peak_memory_delta: 7.485 GB
[36m(run_dp_rank pid=2043249)[0m       peak_memory: 69.863 GB
[36m(run_dp_rank pid=2043249)[0m     Backward:
[36m(run_dp_rank pid=2043249)[0m       backward: 244.137 ms
[36m(run_dp_rank pid=2043249)[0m       total: 245.323 ms
[36m(run_dp_rank pid=2043249)[0m       peak_memory_delta: 0.273 GB
[36m(run_dp_rank pid=2043249)[0m       peak_memory: 73.699 GB
[36m(run_dp_rank pid=2043249)[0m Raw trace data from Actor 1:
[36m(run_dp_rank pid=2043249)[0m {
[36m(run_dp_rank pid=2043249)[0m     "update": {
[36m(run_dp_rank pid=2043249)[0m         "total": [
[36m(run_dp_rank pid=2043249)[0m             39.00342559814453
[36m(run_dp_rank pid=2043249)[0m         ],
[36m(run_dp_rank pid=2043249)[0m         "peak_memory_delta": [
[36m(run_dp_rank pid=2043249)[0m             2.5314102172851562
[36m(run_dp_rank pid=2043249)[0m         ],
[36m(run_dp_rank pid=2043249)[0m         "peak_memory": [
[36m(run_dp_rank pid=2043249)[0m             57.366798400878906
[36m(run_dp_rank pid=2043249)[0m         ]
[36m(run_dp_rank pid=2043249)[0m     },
[36m(run_dp_rank pid=2043249)[0m     "1": {
[36m(run_dp_rank pid=2043249)[0m         "forward": {
[36m(run_dp_rank pid=2043249)[0m             "forward": [
[36m(run_dp_rank pid=2043249)[0m                 122.75542449951172,
[36m(run_dp_rank pid=2043249)[0m                 122.70819091796875,
[36m(run_dp_rank pid=2043249)[0m                 122.02738952636719,
[36m(run_dp_rank pid=2043249)[0m                 122.02550506591797
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "total": [
[36m(run_dp_rank pid=2043249)[0m                 122.75542449951172,
[36m(run_dp_rank pid=2043249)[0m                 122.70819091796875,
[36m(run_dp_rank pid=2043249)[0m                 122.02738952636719,
[36m(run_dp_rank pid=2043249)[0m                 122.02550506591797
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "peak_memory_delta": [
[36m(run_dp_rank pid=2043249)[0m                 7.484588623046875,
[36m(run_dp_rank pid=2043249)[0m                 7.484588623046875,
[36m(run_dp_rank pid=2043249)[0m                 7.485565185546875,
[36m(run_dp_rank pid=2043249)[0m                 7.484588623046875
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "peak_memory": [
[36m(run_dp_rank pid=2043249)[0m                 47.586246490478516,
[36m(run_dp_rank pid=2043249)[0m                 54.97708511352539,
[36m(run_dp_rank pid=2043249)[0m                 70.37590789794922,
[36m(run_dp_rank pid=2043249)[0m                 73.04794311523438
[36m(run_dp_rank pid=2043249)[0m             ]
[36m(run_dp_rank pid=2043249)[0m         },
[36m(run_dp_rank pid=2043249)[0m         "backward": {
[36m(run_dp_rank pid=2043249)[0m             "backward": [
[36m(run_dp_rank pid=2043249)[0m                 243.60357666015625,
[36m(run_dp_rank pid=2043249)[0m                 245.8648681640625,
[36m(run_dp_rank pid=2043249)[0m                 246.2243194580078,
[36m(run_dp_rank pid=2043249)[0m                 246.08396911621094
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "total": [
[36m(run_dp_rank pid=2043249)[0m                 244.5345916748047,
[36m(run_dp_rank pid=2043249)[0m                 246.80380249023438,
[36m(run_dp_rank pid=2043249)[0m                 247.3839111328125,
[36m(run_dp_rank pid=2043249)[0m                 247.34320068359375
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "peak_memory_delta": [
[36m(run_dp_rank pid=2043249)[0m                 0.34375,
[36m(run_dp_rank pid=2043249)[0m                 0.25,
[36m(run_dp_rank pid=2043249)[0m                 0.25,
[36m(run_dp_rank pid=2043249)[0m                 0.25
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "peak_memory": [
[36m(run_dp_rank pid=2043249)[0m                 70.67278289794922,
[36m(run_dp_rank pid=2043249)[0m                 73.25106811523438,
[36m(run_dp_rank pid=2043249)[0m                 69.8211669921875,
[36m(run_dp_rank pid=2043249)[0m                 62.476226806640625
[36m(run_dp_rank pid=2043249)[0m             ]
[36m(run_dp_rank pid=2043249)[0m         }
[36m(run_dp_rank pid=2043249)[0m     },
[36m(run_dp_rank pid=2043249)[0m     "3": {
[36m(run_dp_rank pid=2043249)[0m         "forward": {
[36m(run_dp_rank pid=2043249)[0m             "forward": [
[36m(run_dp_rank pid=2043249)[0m                 183.43299865722656,
[36m(run_dp_rank pid=2043249)[0m                 183.4635467529297,
[36m(run_dp_rank pid=2043249)[0m                 182.96556091308594,
[36m(run_dp_rank pid=2043249)[0m                 183.0693817138672
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "total": [
[36m(run_dp_rank pid=2043249)[0m                 183.43299865722656,
[36m(run_dp_rank pid=2043249)[0m                 183.4635467529297,
[36m(run_dp_rank pid=2043249)[0m                 182.96556091308594,
[36m(run_dp_rank pid=2043249)[0m                 183.0693817138672
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "peak_memory_delta": [
[36m(run_dp_rank pid=2043249)[0m                 9.488510131835938,
[36m(run_dp_rank pid=2043249)[0m                 9.489486694335938,
[36m(run_dp_rank pid=2043249)[0m                 9.488510131835938,
[36m(run_dp_rank pid=2043249)[0m                 9.488510131835938
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "peak_memory": [
[36m(run_dp_rank pid=2043249)[0m                 64.37184524536133,
[36m(run_dp_rank pid=2043249)[0m                 70.42279815673828,
[36m(run_dp_rank pid=2043249)[0m                 75.09873962402344,
[36m(run_dp_rank pid=2043249)[0m                 77.05577087402344
[36m(run_dp_rank pid=2043249)[0m             ]
[36m(run_dp_rank pid=2043249)[0m         },
[36m(run_dp_rank pid=2043249)[0m         "backward": {
[36m(run_dp_rank pid=2043249)[0m             "backward": [
[36m(run_dp_rank pid=2043249)[0m                 431.9942932128906,
[36m(run_dp_rank pid=2043249)[0m                 449.1575927734375,
[36m(run_dp_rank pid=2043249)[0m                 377.27734375,
[36m(run_dp_rank pid=2043249)[0m                 443.7142028808594
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "total": [
[36m(run_dp_rank pid=2043249)[0m                 432.75982666015625,
[36m(run_dp_rank pid=2043249)[0m                 450.27294921875,
[36m(run_dp_rank pid=2043249)[0m                 378.3697204589844,
[36m(run_dp_rank pid=2043249)[0m                 444.5781555175781
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "peak_memory_delta": [
[36m(run_dp_rank pid=2043249)[0m                 5.871094703674316,
[36m(run_dp_rank pid=2043249)[0m                 5.871094703674316,
[36m(run_dp_rank pid=2043249)[0m                 5.871094703674316,
[36m(run_dp_rank pid=2043249)[0m                 5.871094703674316
[36m(run_dp_rank pid=2043249)[0m             ],
[36m(run_dp_rank pid=2043249)[0m             "peak_memory": [
[36m(run_dp_rank pid=2043249)[0m                 70.19606494903564,
[36m(run_dp_rank pid=2043249)[0m                 76.2470178604126,
[36m(run_dp_rank pid=2043249)[0m                 80.92295932769775,
[36m(run_dp_rank pid=2043249)[0m                 82.87999057769775
[36m(run_dp_rank pid=2043249)[0m             ]
[36m(run_dp_rank pid=2043249)[0m         }
[36m(run_dp_rank pid=2043249)[0m     }
[36m(run_dp_rank pid=2043249)[0m }
[36m(run_dp_rank pid=2043249)[0m ========================================
[36m(run_dp_rank pid=2043249)[0m 
[36m(run_dp_rank pid=2043249)[0m Timing and Memory statistics for Actor 1:
[36m(run_dp_rank pid=2043249)[0m   Update:
[36m(run_dp_rank pid=2043249)[0m     total: 39.003 ms
[36m(run_dp_rank pid=2043249)[0m     peak_memory_delta: 2.531 GB
[36m(run_dp_rank pid=2043249)[0m     peak_memory: 57.367 GB
[36m(run_dp_rank pid=2043249)[0m   Stage 1:
[36m(run_dp_rank pid=2043249)[0m     Forward:
[36m(run_dp_rank pid=2043249)[0m       forward: 122.379 ms
[36m(run_dp_rank pid=2043249)[0m       total: 122.379 ms
[36m(run_dp_rank pid=2043249)[0m       peak_memory_delta: 7.485 GB
[36m(run_dp_rank pid=2043249)[0m       peak_memory: 61.497 GB
[36m(run_dp_rank pid=2043249)[0m     Backward:
[36m(run_dp_rank pid=2043249)[0m       backward: 245.444 ms
[36m(run_dp_rank pid=2043249)[0m       total: 246.516 ms
[36m(run_dp_rank pid=2043249)[0m       peak_memory_delta: 0.273 GB
[36m(run_dp_rank pid=2043249)[0m       peak_memory: 69.055 GB
[36m(run_dp_rank pid=2043249)[0m   Stage 3:
[36m(run_dp_rank pid=2043249)[0m     Forward:
[36m(run_dp_rank pid=2043249)[0m       forward: 183.233 ms
[36m(run_dp_rank pid=2043249)[0m       total: 183.233 ms
[36m(run_dp_rank pid=2043249)[0m       peak_memory_delta: 9.489 GB
[36m(run_dp_rank pid=2043249)[0m       peak_memory: 71.737 GB
[36m(run_dp_rank pid=2043249)[0m     Backward:
[36m(run_dp_rank pid=2043249)[0m       backward: 425.536 ms
[36m(run_dp_rank pid=2043249)[0m       total: 426.495 ms
[36m(run_dp_rank pid=2043249)[0m       peak_memory_delta: 5.871 GB
[36m(run_dp_rank pid=2043249)[0m       peak_memory: 77.562 GB
[36m(PiperActor pid=2061066)[0m [rank0]:[W128 21:52:29.856438211 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())
[36m(PiperActor pid=2062326)[0m 2026-01-28 21:51:58,470 - piper_actor - INFO - Actor 1: Tracing enabled
[36m(PiperActor pid=2062326)[0m [rank1]:[W128 21:52:29.315247480 TCPStore.cpp:125] [c10d] recvValue failed on SocketImpl(fd=118, addr=[localhost]:57278, remote=[localhost]:12345): Failed to recv, got 0 bytes. Connection was likely closed. Did the remote server shutdown or crash?
[36m(PiperActor pid=2062326)[0m Exception raised from recvBytes at /pytorch/torch/csrc/distributed/c10d/Utils.hpp:682 (most recent call first):
[36m(PiperActor pid=2062326)[0m frame #0: c10::Error::Error(c10::SourceLocation, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >) + 0x80 (0x7f262c177b80 in /m-coriander/coriander/wxdeng/conda-envs/piper_ref/lib/python3.10/site-packages/torch/lib/libc10.so)
[36m(PiperActor pid=2062326)[0m frame #1: <unknown function> + 0x5ffc5b1 (0x7ef6614785b1 in /m-coriander/coriander/wxdeng/conda-envs/piper_ref/lib/python3.10/site-packages/torch/lib/libtorch_cpu.so)
[36m(PiperActor pid=2062326)[0m frame #2: <unknown function> + 0x5ffd9ad (0x7ef6614799ad in /m-coriander/coriander/wxdeng/conda-envs/piper_ref/lib/python3.10/site-packages/torch/lib/libtorch_cpu.so)
[36m(PiperActor pid=2062326)[0m frame #3: <unknown function> + 0x5ffe55a (0x7ef66147a55a in /m-coriander/coriander/wxdeng/conda-envs/piper_ref/lib/python3.10/site-packages/torch/lib/libtorch_cpu.so)
[36m(PiperActor pid=2062326)[0m frame #4: c10d::TCPStore::check(std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > > const&) + 0x31e (0x7ef66147527e in /m-coriander/coriander/wxdeng/conda-envs/piper_ref/lib/python3.10/site-packages/torch/lib/libtorch_cpu.so)
[36m(PiperActor pid=2062326)[0m frame #5: c10d::ProcessGroupNCCL::HeartbeatMonitor::runLoop() + 0x3c8 (0x7ef61fff4868 in /m-coriander/coriander/wxdeng/conda-envs/piper_ref/lib/python3.10/site-packages/torch/lib/libtorch_cuda.so)
[36m(PiperActor pid=2062326)[0m frame #6: <unknown function> + 0xdf0e6 (0x7f264d4550e6 in /m-coriander/coriander/wxdeng/conda-envs/piper_ref/bin/../lib/libstdc++.so.6)
[36m(PiperActor pid=2062326)[0m frame #7: <unknown function> + 0x8b2ea (0x7f265208b2ea in /lib64/libc.so.6)
[36m(PiperActor pid=2062326)[0m frame #8: <unknown function> + 0x1103c0 (0x7f26521103c0 in /lib64/libc.so.6)
[36m(PiperActor pid=2062326)[0m 
[36m(PiperActor pid=2062326)[0m [rank1]:[W128 21:52:29.319902527 ProcessGroupNCCL.cpp:1771] [PG ID 0 PG GUID 0 Rank 1] Failed to check the "should dump" flag on TCPStore, (maybe TCPStore server has shut down too early), with error: Failed to recv, got 0 bytes. Connection was likely closed. Did the remote server shutdown or crash?
Traceback (most recent call last):
  File "/m-coriander/coriander/wxdeng/conda-envs/piper_ref/lib/python3.10/runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/m-coriander/coriander/wxdeng/conda-envs/piper_ref/lib/python3.10/runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "/m-coriander/coriander/wxdeng/mlsys/piper_ref/test/test_llama.py", line 292, in <module>
    time.sleep(3600)
KeyboardInterrupt
[36m(PiperActor pid=2062326)[0m [rank1]:[W128 21:52:30.635698326 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())
